# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: builds artifact

on:
  workflow_dispatch

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up .NET Core
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '3.1.x'

      - name: Build and publish projects
        run: |
          for project in $(find . -name '*.csproj'); do
            project_dir=$(dirname $project)
            project_name=$(basename $project .csproj)
            output_dir="$project_dir/bin/Release/netcoreapp3.1/publish"
      
            dotnet publish $project --configuration Release --output $output_dir
          done
          
  upload-Common-Service:
    runs-on: ubuntu-latest    
    needs: build-and-publish
    steps:
      - name: Upload Common.Service Artifact
        uses: actions/upload-artifact@v2
        with:
          name: Common.Service
          path: ./FHHL/Common.Service/bin/Release/netcoreapp3.1/publish     
     
  upload-Common-Web:
    runs-on: ubuntu-latest   
    needs: build-and-publish
    steps:
      - name: Upload Common.Web Artifact
        uses: actions/upload-artifact@v2
        with:
          name: Common.Web
          path: ./FHHL/Common.Web/bin/Release/netcoreapp3.1/publish
          
  upload-Common-FHHL-Data:
    runs-on: ubuntu-latest  
    needs: build-and-publish
    steps:
      - name: Upload FHHL.Data Artifact
        uses: actions/upload-artifact@v2
        with:
          name: FHHL.Data
          path: ./FHHL/FHHL.Data/bin/Release/netcoreapp3.1/publish 
          
  upload-FHHL-BLL:
    runs-on: ubuntu-latest   
    needs: build-and-publish
    steps:
      - name: Upload FHHL.BLL Artifact
        uses: actions/upload-artifact@v2
        with:
          name: FHHL.BLL
          path: ./FHHL/FHHL.BLL/bin/Release/netcoreapp3.1/publish
          
  upload-FHHL:
    runs-on: ubuntu-latest    
    needs: build-and-publish
    steps:
      - name: Upload FHHL Artifact
        uses: actions/upload-artifact@v2
        with:
          name: FHHL
          path: ./FHHL/FHHL/bin/Release/netcoreapp3.1/publish




